# 고급 타입

타입스크립트는 그렇게 까다롭다는 하스켈 프로그래머의 부러움을 살 정도로 강력한 타입 수준 프로그래밍 기능을 갖춘, 세계 최고 수준의 타입시스템을 자랑한다.특히 타입스크립트는 타입을 명시하지 않아도 대부분 추론해준다.
자바스크립트는 너무 동적이므로 이렇게 표현력이 좋고 훌륭한 타입 시스템이 필요하다. 프로토타입, this의 동적연결, 함수 오버로딩, 항상 바뀌는 객체등을 제대로 사용하려면 풍부한 타입시스템과 다양한 타입 연산자 도구가 필요하다.

## 타입간의 관계

서브 타입이란 무엇일까 두개의 타입 a 와 b 가 있고 b가 a 의 서브 타입이면 a 가 필요한 곳에는 어디든 b를 안전하게 사용할 수 있다.

- 배열은 객체의 서브타입이다.
- 튜플은 배열의 서브타입이다.
- 모든것은 any의 서브타입이다.
- never은 모든 것의 서브타입이다.
- Animal을 상속받는 Bird 클래스가 있다면 Bird는 Animal의 서브 타입이다.

서브타입의 정의를 여기에 적용하면 다음과 같이 설명할 수 있다.

- 객체를 사용해야하는 곳에 배열도 사용할 수 있다.
- 배열을 사용해야하는 곳에 튜플도 사용할 수 있다.
- any를 사용해야하는 곳에 객체도 사용할 수 있다.
- 어디에나 never을 사용할 수 있다.
- Animal을 사용해야하는 곳에 Bird도 사용할 수 있다.

슈퍼타입을 알아보자. 두개의 타입 a b 가있고, B가  A의 슈퍼타입이면 B가 필요한 곳에는 어디든 A를 안전하게 사용할 수 있다.

- 배열은 튜플의 슈퍼타입이다.
- 객체는 배열의 슈퍼타입이다.
- any는 모든것의 슈퍼타입이다.
- never은 누구의 슈퍼타입도 아니다.
- Animal은 Bird의 슈퍼타입이다.

예를 하나 들겠다. number 은  number | string 유니온에 포함되므로 number | string 의 서브타입이다.


다른 타입을 포함하는 타입 Array<A>처럼 타입 매개변수를 갖거나, {a:number} 같은 필드를 갖는 형태 혹은 (a: A) => B 같은 서브타입 규칙은 추론하기가 어려워서 명확하게 답변을 내놓기 어렵다. 사실 이런 복합 타입의 서브타입 규칙은 프로그래밍 언어마다 다르며 같은 규칙을 가진 언어가 거의 없을 정도이다.

타입스크립트에서 모든 복합타입의 멤버(객체 클래스, 배열, 함수, 반환 타입)은 공변이며 함수 매개변수 타입만 예외적으로 반변이다.

> TSC 플래그 호환성으로 인하여 타입스크립트의 함수의 매개변수 this 타입은 기본적으로 공변이다. 앞에서 살펴본 더 안전한 공변을 사용하려면 tsconfig.sjon 에서 {" strictFunctionTypes": true} 플래그를 설정해야한다. strict 모드는 위속성을 포함하므로 strict 를 true 로 설정했다면 별도 설정은 필요없다.

서브타입과 슈퍼타입의 관계는 모든 정적 타입언어에서 중요한 개념이다. 또한 할당성이 어떻게 동작하는지 이해하는 데도 중요하다. 할당성이란 A라는 타입을 다른 B라는 타입이 필요한 곳에 사용할수 있는지를 결정하는 타입스크립트 규칙을 의미한다.

A를 B에 할당할 수 있는가..? 라는 질문이 발생하면 타입스크립트는 다음과 같은 몇가지 규칙에 따라 처리한다. 배열, 불, 숫자, 객체,함수, 클래스, 클래스 인스턴스, 문자열, 리터럴 타입등 열거형이 아닌 타입에서는 다음의 규칙으로 A를 B에 할당할 수 있는지 결정한다.

1. A <: B
2. A는 any

