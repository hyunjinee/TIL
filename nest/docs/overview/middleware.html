<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Middleware | 오늘 나는 최선을 다 했는가?</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/TIL/logo.png">
    <meta name="description" content="⭐️">
    
    <link rel="preload" href="/TIL/assets/css/0.styles.295d7bc5.css" as="style"><link rel="preload" href="/TIL/assets/js/app.a5d3049c.js" as="script"><link rel="preload" href="/TIL/assets/js/4.c90964a3.js" as="script"><link rel="preload" href="/TIL/assets/js/2.ffa2e3a3.js" as="script"><link rel="preload" href="/TIL/assets/js/79.25c870ac.js" as="script"><link rel="prefetch" href="/TIL/assets/js/10.9766f46c.js"><link rel="prefetch" href="/TIL/assets/js/11.38ab8331.js"><link rel="prefetch" href="/TIL/assets/js/12.6d455ea0.js"><link rel="prefetch" href="/TIL/assets/js/13.d2e60e72.js"><link rel="prefetch" href="/TIL/assets/js/14.1e01c32f.js"><link rel="prefetch" href="/TIL/assets/js/15.8ee3bf61.js"><link rel="prefetch" href="/TIL/assets/js/16.c28943cf.js"><link rel="prefetch" href="/TIL/assets/js/17.fdceb0f1.js"><link rel="prefetch" href="/TIL/assets/js/18.47ff19fa.js"><link rel="prefetch" href="/TIL/assets/js/19.4d9a2a45.js"><link rel="prefetch" href="/TIL/assets/js/20.4a4fc06a.js"><link rel="prefetch" href="/TIL/assets/js/21.43d2dff3.js"><link rel="prefetch" href="/TIL/assets/js/22.273436b1.js"><link rel="prefetch" href="/TIL/assets/js/23.5276a847.js"><link rel="prefetch" href="/TIL/assets/js/24.b54571ee.js"><link rel="prefetch" href="/TIL/assets/js/25.0e410122.js"><link rel="prefetch" href="/TIL/assets/js/26.4cd94c55.js"><link rel="prefetch" href="/TIL/assets/js/27.d9fc6d0f.js"><link rel="prefetch" href="/TIL/assets/js/28.127f1351.js"><link rel="prefetch" href="/TIL/assets/js/29.398e72bb.js"><link rel="prefetch" href="/TIL/assets/js/3.da50a5fc.js"><link rel="prefetch" href="/TIL/assets/js/30.d2965602.js"><link rel="prefetch" href="/TIL/assets/js/31.557af5e1.js"><link rel="prefetch" href="/TIL/assets/js/32.901483df.js"><link rel="prefetch" href="/TIL/assets/js/33.cf9a4f1f.js"><link rel="prefetch" href="/TIL/assets/js/34.d936fd76.js"><link rel="prefetch" href="/TIL/assets/js/35.c0e2354c.js"><link rel="prefetch" href="/TIL/assets/js/36.4b174621.js"><link rel="prefetch" href="/TIL/assets/js/37.c26696ec.js"><link rel="prefetch" href="/TIL/assets/js/38.09356d86.js"><link rel="prefetch" href="/TIL/assets/js/39.5b073e3a.js"><link rel="prefetch" href="/TIL/assets/js/40.f6db196d.js"><link rel="prefetch" href="/TIL/assets/js/41.4193180c.js"><link rel="prefetch" href="/TIL/assets/js/42.6ffdcce0.js"><link rel="prefetch" href="/TIL/assets/js/43.1083a118.js"><link rel="prefetch" href="/TIL/assets/js/44.0bca2037.js"><link rel="prefetch" href="/TIL/assets/js/45.52cb52f3.js"><link rel="prefetch" href="/TIL/assets/js/46.b8ea3fa3.js"><link rel="prefetch" href="/TIL/assets/js/47.9d8edc8b.js"><link rel="prefetch" href="/TIL/assets/js/48.5dcf2483.js"><link rel="prefetch" href="/TIL/assets/js/49.651e3e70.js"><link rel="prefetch" href="/TIL/assets/js/5.c7470a6d.js"><link rel="prefetch" href="/TIL/assets/js/50.b543a115.js"><link rel="prefetch" href="/TIL/assets/js/51.6aec8d5f.js"><link rel="prefetch" href="/TIL/assets/js/52.31516e70.js"><link rel="prefetch" href="/TIL/assets/js/53.8eb17279.js"><link rel="prefetch" href="/TIL/assets/js/54.ca9bbebf.js"><link rel="prefetch" href="/TIL/assets/js/55.b7f6b3c0.js"><link rel="prefetch" href="/TIL/assets/js/56.ae5753c6.js"><link rel="prefetch" href="/TIL/assets/js/57.698bc1c9.js"><link rel="prefetch" href="/TIL/assets/js/58.774784db.js"><link rel="prefetch" href="/TIL/assets/js/59.3f7cc6f2.js"><link rel="prefetch" href="/TIL/assets/js/6.14a7eaec.js"><link rel="prefetch" href="/TIL/assets/js/60.8ba623d5.js"><link rel="prefetch" href="/TIL/assets/js/61.ca6cdc71.js"><link rel="prefetch" href="/TIL/assets/js/62.11836466.js"><link rel="prefetch" href="/TIL/assets/js/63.df3178ba.js"><link rel="prefetch" href="/TIL/assets/js/64.a072b044.js"><link rel="prefetch" href="/TIL/assets/js/65.70c2f9ef.js"><link rel="prefetch" href="/TIL/assets/js/66.0d70f74d.js"><link rel="prefetch" href="/TIL/assets/js/67.5c92cb61.js"><link rel="prefetch" href="/TIL/assets/js/68.c2aaf572.js"><link rel="prefetch" href="/TIL/assets/js/69.0538c91e.js"><link rel="prefetch" href="/TIL/assets/js/7.2c7697a1.js"><link rel="prefetch" href="/TIL/assets/js/70.551545bc.js"><link rel="prefetch" href="/TIL/assets/js/71.f4397fbb.js"><link rel="prefetch" href="/TIL/assets/js/72.5130af55.js"><link rel="prefetch" href="/TIL/assets/js/73.9255e536.js"><link rel="prefetch" href="/TIL/assets/js/74.ef63156e.js"><link rel="prefetch" href="/TIL/assets/js/75.d54a87fb.js"><link rel="prefetch" href="/TIL/assets/js/76.1e9d5169.js"><link rel="prefetch" href="/TIL/assets/js/77.bd832585.js"><link rel="prefetch" href="/TIL/assets/js/78.6d8e2fdc.js"><link rel="prefetch" href="/TIL/assets/js/8.007b7eee.js"><link rel="prefetch" href="/TIL/assets/js/80.bf61d628.js"><link rel="prefetch" href="/TIL/assets/js/81.07149609.js"><link rel="prefetch" href="/TIL/assets/js/82.eefe1602.js"><link rel="prefetch" href="/TIL/assets/js/83.280c6a79.js"><link rel="prefetch" href="/TIL/assets/js/84.a38ebbbc.js"><link rel="prefetch" href="/TIL/assets/js/85.12e72d66.js"><link rel="prefetch" href="/TIL/assets/js/86.8b87dca5.js"><link rel="prefetch" href="/TIL/assets/js/87.9e8d7da9.js"><link rel="prefetch" href="/TIL/assets/js/88.b8649991.js"><link rel="prefetch" href="/TIL/assets/js/9.74511a11.js">
    <link rel="stylesheet" href="/TIL/assets/css/0.styles.295d7bc5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-58ec7a20><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/TIL/" class="home-link router-link-active"><!----> <span class="site-name">오늘 나는 최선을 다 했는가?</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/TIL/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/TIL/about/" class="nav-link">
  About
</a></div><div class="nav-item"><a href="/TIL/contact/" class="nav-link">
  Contact
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/TIL/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/TIL/about/" class="nav-link">
  About
</a></div><div class="nav-item"><a href="/TIL/contact/" class="nav-link">
  Contact
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Nest</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Documentation</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/TIL/nest/docs/introduction.html" class="sidebar-link">INTRODUCTION</a></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading open"><span>OVERVIEW</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/TIL/nest/docs/overview/first-steps.html" class="sidebar-link">First steps</a></li><li><a href="/TIL/nest/docs/overview/controllers.html" class="sidebar-link">Controllers</a></li><li><a href="/TIL/nest/docs/overview/providers.html" class="sidebar-link">Providers</a></li><li><a href="/TIL/nest/docs/overview/modules.html" class="sidebar-link">Modules</a></li><li><a href="/TIL/nest/docs/overview/middleware.html" aria-current="page" class="active sidebar-link">Middleware</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TIL/nest/docs/overview/middleware.html#dependency-injection" class="sidebar-link">Dependency injection</a></li><li class="sidebar-sub-header"><a href="/TIL/nest/docs/overview/middleware.html#applying-middleware" class="sidebar-link">Applying middleware</a></li><li class="sidebar-sub-header"><a href="/TIL/nest/docs/overview/middleware.html#route-wildcards" class="sidebar-link">Route wildcards</a></li><li class="sidebar-sub-header"><a href="/TIL/nest/docs/overview/middleware.html#middleware-consumer" class="sidebar-link">Middleware consumer</a></li><li class="sidebar-sub-header"><a href="/TIL/nest/docs/overview/middleware.html#excluding-routes" class="sidebar-link">Excluding routes</a></li><li class="sidebar-sub-header"><a href="/TIL/nest/docs/overview/middleware.html#functional-middleware" class="sidebar-link">Functional middleware</a></li><li class="sidebar-sub-header"><a href="/TIL/nest/docs/overview/middleware.html#multiple-middleware" class="sidebar-link">Multiple middleware</a></li><li class="sidebar-sub-header"><a href="/TIL/nest/docs/overview/middleware.html#global-middleware" class="sidebar-link">Global middleware</a></li></ul></li><li><a href="/TIL/nest/docs/overview/exception-filters.html" class="sidebar-link">Exception filters</a></li></ul></section></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Redux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Webpack</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="middleware"><a href="#middleware" class="header-anchor">#</a> Middleware</h1> <p>미들웨어는 라우트 핸들러 전에 호출되는 함수입니다. 미들웨어 함수는 요청 및 응답 객체에 접근할 수 있으며 어플리케이션의 요청-응답 주기에 있는 next() 미들웨어 함수에 접근 할 수 있습니다. <code>next()</code>미들웨어 함수는 <code>next</code>라는 변수로 표시됩니다.</p> <p><img src="https://user-images.githubusercontent.com/63354527/152908342-dcaf81f8-c2e2-4e1f-a053-5da59538e862.png" alt="image"></p> <p>Nest 미들웨어는 기본적으로 익스프레스 미들웨어랑 동일합니다. 공식 익스프레스 문서의 다음 설명은 미들웨어의 기능에 대해 설명합니다.</p> <blockquote><p>미들웨어 기능은 다음 작업을 수행할 수 있습니다.</p> <ul><li>어떤 코드나 실행가능.</li> <li>요청 객체와 응답객체를 변화시킬 수 있다.</li> <li>요청과 응답 사이클을 끝낼 수 있다.</li> <li>stack에 있는 다음 미들웨어 함수를 호출할 수 있다.</li> <li>현재 미들웨어 함수가 요청-응답주기를 종료하지 않으면 next()를 호출하여 다음 미들웨어 함수에 제어를 전달해야 합니다. 그렇지 않으면 요청이 중단됩니다.</li></ul></blockquote> <p>함수또는 <code>@Injectable()</code>데코레이터가 있는 클래스에서 사용자 지정 Nest미들웨어를 구현합니다. 클래스는 NestMiddleware 인터페이스를 구현해야 하지만 함수에는 특별한 요구사항이 없습니다. class 메서드를 사용하여 간단한 미들웨어 기능을 구현해봅시다!</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable<span class="token punctuation">,</span> NestMiddleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@nestjs/common&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Request<span class="token punctuation">,</span> Response<span class="token punctuation">,</span> NextFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;express&quot;</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">LoggerMiddleware</span> <span class="token keyword">implements</span> <span class="token class-name">NestMiddleware</span> <span class="token punctuation">{</span>
  <span class="token function">use</span><span class="token punctuation">(</span>req<span class="token operator">:</span> Request<span class="token punctuation">,</span> res<span class="token operator">:</span> Response<span class="token punctuation">,</span> next<span class="token operator">:</span> NextFunction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Request...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="dependency-injection"><a href="#dependency-injection" class="header-anchor">#</a> Dependency injection</h2> <p>Nest 미들웨어는 Dependency Injection을 완벽하게 지원합니다. provider와 컨트롤러와 마찬가지로 동일한 모듈 내에서 사용 가능한 종속성을 주입할 수 있습니다. 이것은 생성자를 통해 수행됩니다.</p> <h2 id="applying-middleware"><a href="#applying-middleware" class="header-anchor">#</a> Applying middleware</h2> <p><code>@Module()</code> 데코레이터에는 미들웨어가 들어갈 자리가 없습니다. 대신 모듈 클래스의 <code>configure()</code> 메서드를 사용하여 설정합니다. 미들웨어를 포함하는 모듈은 NestModule 인터페이스를 구현해야 합니다. AppModule 수준에서 LoggerMiddleware를 설정해 보겠습니다.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Module<span class="token punctuation">,</span> NestModule<span class="token punctuation">,</span> MiddlewareConsumer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@nestjs/common&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> LoggerMiddleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./common/middleware/logger.middleware&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> CatsModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./cats/cats.module&quot;</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>CatsModule<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token keyword">implements</span> <span class="token class-name">NestModule</span> <span class="token punctuation">{</span>
  <span class="token function">configure</span><span class="token punctuation">(</span>consumer<span class="token operator">:</span> MiddlewareConsumer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">consumer</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>LoggerMiddleware<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forRoutes</span><span class="token punctuation">(</span><span class="token string">&quot;cats&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>위의 예에서 우리는 이전에 CatsController 내부에 정의된 /cat 라우트 핸들러에 대해 <code>LoggerMiddleware</code>를 설정했습니다. 또한 미들웨어를 구성할 때 라우트 경로와 요청 메서드를 포함하는 개개체를 forRoutes()메서드에 전달하여 미들웨어를 특정 요청 메서드로 제한 할 수 있습니다. 아래의 예에서 원하는 요청 메서드 유형을 참조하기 위해 RequestMethod enum을 가져옵니다.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Module<span class="token punctuation">,</span> NestModule<span class="token punctuation">,</span> RequestMethod<span class="token punctuation">,</span> MiddlewareConsumer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@nestjs/common&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> LoggerMiddleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./common/middleware/logger.middleware&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> CatsModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./cats/cats.module&quot;</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>CatsModule<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token keyword">implements</span> <span class="token class-name">NestModule</span> <span class="token punctuation">{</span>
  <span class="token function">configure</span><span class="token punctuation">(</span>consumer<span class="token operator">:</span> MiddlewareConsumer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">consumer</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>LoggerMiddleware<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forRoutes</span><span class="token punctuation">(</span><span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">&quot;cats&quot;</span><span class="token punctuation">,</span> method<span class="token operator">:</span> RequestMethod<span class="token punctuation">.</span><span class="token constant">GET</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="route-wildcards"><a href="#route-wildcards" class="header-anchor">#</a> Route wildcards</h2> <p>패턴 기반 경로도 지원됩니다. 예를 들어 별표는 와일드 카드로 사용되며 모든 문자 조합과 일치합니다.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token function">forRoutes</span><span class="token punctuation">(</span><span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">&quot;ab*cd&quot;</span><span class="token punctuation">,</span> method<span class="token operator">:</span> RequestMethod<span class="token punctuation">.</span><span class="token constant">ALL</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>ab*cd</code> 경로는 <code>abcd</code>, <code>ab_cd</code>, <code>abecd</code> 등과 일치합니다. ?, + 및 () 문자는 라우팅 경로에 사용될 수 있으며 해당 정규식 대응의 하위 집합입니다. -, . 은 문자 그대로 문자열 기반 경로로 해석됩니다.</p> <h2 id="middleware-consumer"><a href="#middleware-consumer" class="header-anchor">#</a> Middleware consumer</h2> <p>미들웨어는 도우미 클래스입니다. 미들웨어를 관리하는 몇가지 기본 제공 메서드를 제공합니다. 이들 모두 단순히 fluent style로 체이닝될 수 있습니다.</p> <p><code>forRoutes</code>메서드는 단일 문자열, 여러문자열, RouteInfo객체, 컨트롤러 클래스 및 여러 컨트롤러 클래스를 사용할 수 있습니다. 대부분의 경우 쉼표로 구분된 컨트롤러 목록을 전달할 것입니다. 아래는 단일 컨트롤러의 예입니다.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Module<span class="token punctuation">,</span> NestModule<span class="token punctuation">,</span> MiddlewareConsumer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@nestjs/common&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> LoggerMiddleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./common/middleware/logger.middleware&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> CatsModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./cats/cats.module&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> CatsController <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./cats/cats.controller&quot;</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>CatsModule<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token keyword">implements</span> <span class="token class-name">NestModule</span> <span class="token punctuation">{</span>
  <span class="token function">configure</span><span class="token punctuation">(</span>consumer<span class="token operator">:</span> MiddlewareConsumer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">consumer</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>LoggerMiddleware<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forRoutes</span><span class="token punctuation">(</span>CatsController<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="excluding-routes"><a href="#excluding-routes" class="header-anchor">#</a> Excluding routes</h2> <p>때때로 우리는 미들웨어가 적용되는 특정 경로를 제외하고 싶을 때가 있습니다. <code>exclue()</code>메서드를 사용하여 특정 경로를 쉽게 제거할 수 있습니다. 이 메서드는 아래와 같이 제외할 경로를 식별하는 단일 문자열, 여러 문자열 또는 <code>RouteInfo</code>객체를 사용할 수 있습니다.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token function">consumer</span>
  <span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>LoggerMiddleware<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">exclude</span><span class="token punctuation">(</span><span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">&quot;cats&quot;</span><span class="token punctuation">,</span> method<span class="token operator">:</span> RequestMethod<span class="token punctuation">.</span><span class="token constant">GET</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">&quot;cats&quot;</span><span class="token punctuation">,</span> method<span class="token operator">:</span> RequestMethod<span class="token punctuation">.</span><span class="token constant">POST</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;cats/(.*)&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">forRoutes</span><span class="token punctuation">(</span>CatsController<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="functional-middleware"><a href="#functional-middleware" class="header-anchor">#</a> Functional middleware</h2> <p>우리가 사용한 <code>LoggerMiddleware</code>는 매우 간단합니다. 이는 멤버, 추가 메서드및 종속성이 없습니다. 클래스 대신 간단한 함수로 정의하면 안됩니까?!!? 네 할 수 있습니다. 이러한 유형의 미들웨어를 <code>functional middleware</code>라고 합니다. 차이점을 섦여하기 위해 로거 미들웨어를 클래스기반에서 함수형 미들웨어로 변환해봅시다.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Request<span class="token punctuation">,</span> Response<span class="token punctuation">,</span> NextFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;express&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">logger</span><span class="token punctuation">(</span>req<span class="token operator">:</span> Request<span class="token punctuation">,</span> res<span class="token operator">:</span> Response<span class="token punctuation">,</span> next<span class="token operator">:</span> NextFunction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Request...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>그리고 <code>AppModule</code> 에서 다음과 같이 적용합니다.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token function">consumer</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>logger<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forRoutes</span><span class="token punctuation">(</span>CatsController<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="multiple-middleware"><a href="#multiple-middleware" class="header-anchor">#</a> Multiple middleware</h2> <p>위에서 언급했듯이 순차적으로 실행되는 미들웨어를 바인딩하려면 apply()메서드 내부에 쉼표로 구분된 목록을 제공하기만 하면 됩니다.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token function">consumer</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">helmet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> logger<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forRoutes</span><span class="token punctuation">(</span>CatsController<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="global-middleware"><a href="#global-middleware" class="header-anchor">#</a> Global middleware</h2> <p>등록된 모든 경로에 미들웨어를 바인딩하려는 경우 <code>INestApplication</code>에서 제공하는 use() 메서드를 사용할 수 있습니다</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> NestFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>AppModule<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>logger<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/TIL/nest/docs/overview/modules.html" class="prev">
        Modules
      </a></span> <span class="next"><a href="/TIL/nest/docs/overview/exception-filters.html">
        Exception filters
      </a>
      →
    </span></p></div> <div id="disqus_thread" class="content" data-v-58ec7a20></div></main></div><div class="global-ui"></div></div>
    <script src="/TIL/assets/js/app.a5d3049c.js" defer></script><script src="/TIL/assets/js/4.c90964a3.js" defer></script><script src="/TIL/assets/js/2.ffa2e3a3.js" defer></script><script src="/TIL/assets/js/79.25c870ac.js" defer></script>
  </body>
</html>
